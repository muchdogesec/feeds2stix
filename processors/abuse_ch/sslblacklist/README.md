# abuse.ch SSLBL SSL Certificate Blacklist (SHA1 Fingerprints)

![](processors/abuse_ch/sslblacklist/sslblacklist.png)

## tl;dr logic of the script

The script works like so

1. downloads csv from `https://sslbl.abuse.ch/blacklist/sslblacklist.csv`
2. turns the entries found in the csv doc into STIX objects (as described in this doc). STIX objects are stored to the filesystemstore in `bundles/abuse_ch/sslblacklist/stix2_objects`.
3. the stix objects are stored in STIX bundles by the malware they are linked to in the data (`Listingreason` column of input csv)

## Overview

> The SSL Certificate Blacklist (CSV) is a CSV that contains SHA1 Fingerprint of all SSL certificates blacklisted on SSLBL. This format is useful if you want to process the blacklisted SSL certificate further, e.g. loading them into your SIEM. The CSV contains the following values:
> * Listing date (UTC)
> * SHA1 Fingerprint of the blacklisted SSL certificate
> * Listing reason
> The SSL Certificate Blacklist (CSV) gets generated every 5 minutes. Please do not fetch it more often than every 5 minutes.

https://sslbl.abuse.ch/blacklist/#ssl-certificates-csv

## Data source

https://sslbl.abuse.ch/blacklist/sslblacklist.csv

## Data schema

```
################################################################
# abuse.ch SSLBL SSL Certificate Blacklist (SHA1 Fingerprints) #
# Last updated: 2024-07-11 07:15:27 UTC                        #
#                                                              #
# Terms Of Use: https://sslbl.abuse.ch/blacklist/              #
# For questions please contact sslbl [at] abuse.ch             #
################################################################
#
# Listingdate,SHA1,Listingreason
2024-07-11 07:15:27,1bd1fee41dac6fda021becc6ed67c26e7e7315ed,Sliver C&C
2024-07-11 07:08:09,0cb3da710c6dc833050a82f4d3864c05ddcb76c8,Vidar C&C
2024-07-11 06:57:29,772c8f46f11ba3c7612b0fddc01ef4348f21483d,AsyncRAT C&C
2024-07-10 05:49:35,7332640210cc4cf0157a7d6843e9793f7d5e75bb,Vidar C&C
2024-07-10 05:49:26,6ca86b5f28ce1182eacbc9e19231dc39fc4f920a,Vidar C&C
2024-07-09 09:23:38,051b8e4f4a3e279ba2179dbf148bf6d16982b8ce,AsyncRAT C&C
2024-07-09 09:23:28,a0cf3ddb0fa7f0bdc42c025c84d9dd0e2331f832,AsyncRAT C&C
```

## Data Normalisation

There are some entries we've decided to normalise. We replace the following values in the input (in the following order):

1. `malware distribution`->blank
2. `Malware distribution`->`Malware`
3. `Cobalt C&C`->`CobaltStrike C&C`
4. ` C&C`->blank

## STIX objects

### Imported objects:

* marking-definition: https://raw.githubusercontent.com/muchdogesec/stix4doge/main/objects/marking-definition/feeds2stix.json
* identity: https://raw.githubusercontent.com/muchdogesec/stix4doge/main/objects/identity/feeds2stix.json

### Generated object mappings:

```json
{
    "type": "marking-definition",
    "spec_version": "2.1",
    "id": "marking-definition--a1cb37d2-3bd3-5b23-8526-47a22694b7e0",
    "created_by_ref": "identity--a1cb37d2-3bd3-5b23-8526-47a22694b7e0",
    "created": "2020-01-01T00:00:00.000Z",
    "definition_type": "statement",
    "definition": {
        "statement": "Origin data source: https://sslbl.abuse.ch/blacklist/sslblacklist.csv"
    },
    "object_marking_refs": [
        "marking-definition--94868c89-83c2-464b-929b-a1a8aa3c8487",
        "marking-definition--a1cb37d2-3bd3-5b23-8526-47a22694b7e0"
    ]
}
```

```json
{
	"type": "file",
	"spec_version": "2.1",
	"id": "file--<GENERATED BY STIX2 LIB>",
	"hashes": {
		"SHA-1": "<SHA1>"
	}
}
```

```json
{
	"type": "malware",
	"spec_version": "2.1",
	"id": "malware--<UUIDV5>",
    "created_by_ref": "identity--a1cb37d2-3bd3-5b23-8526-47a22694b7e0",
	"created": "Earliest <Listingdate>",
	"modified": "Latest <Listingdate>",
	"name": "<Listingreason> (without C&C part)",
	"malware_types": [
		"remote-access-trojan"
	],
	"is_family": true,
	"sample_refs": [
		"<ALL FILE OBJECT IDs LINKED TO <Listingreason>"
	],
    "object_marking_refs": [
        "marking-definition--94868c89-83c2-464b-929b-a1a8aa3c8487",
        "marking-definition--a1cb37d2-3bd3-5b23-8526-47a22694b7e0"
    ]
}
```

UUIDv5 is generated using namespace `a1cb37d2-3bd3-5b23-8526-47a22694b7e0` (feed marking definition uuid) and value `name`

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<SAME AS ASSOCIATED MALWARE OBJECT>",
    "created_by_ref": "identity--a1cb37d2-3bd3-5b23-8526-47a22694b7e0",
    "created": "Earliest <Listingdate>",
    "modified": "Latest <Listingdate>",
    "indicator_types": [
    	"malicious-activity"
    ],
    "name": "<Listingreason> (without C&C part)",
    "pattern": "([ file:hashes.'SHA-1' = '<SHA1>' ] OR [ file:hashes.'SHA-1' = '<SHA1>' ])",
    "pattern_type": "stix",
    "valid_from": "<Listingdate>",
    "object_marking_refs": [
        "marking-definition--94868c89-83c2-464b-929b-a1a8aa3c8487",
        "marking-definition--a1cb37d2-3bd3-5b23-8526-47a22694b7e0"
    ]
  }
```

The `pattern` contains all file sha1 hashes linked to the malware this indicator is representing. All SCOs referenced in the `pattern` are linked from the Indicator to the File SCO

```json
{
	"type": "relationship",
	"spec_version": "2.1",
	"id": "relationship--<UUIDV5>",
    "created": "<Listingdate> of row for file object",
    "modified": "<Listingdate> of row for file object",
    "created_by_ref": "identity--a1cb37d2-3bd3-5b23-8526-47a22694b7e0",
    "relationship_type": "pattern-contains",
    "source_ref": "indicator--<ID>",
    "target_ref": "file--<ID>",
    "object_marking_refs": [
        "marking-definition--94868c89-83c2-464b-929b-a1a8aa3c8487",
        "marking-definition--a1cb37d2-3bd3-5b23-8526-47a22694b7e0"
    ]
}
```

UUIDv5 is generated using namespace `a1cb37d2-3bd3-5b23-8526-47a22694b7e0` and `source_ref+target_ref`

A relationship is also created linking the Malware objects to the Indicator for each malware entry

```json
{
    "type": "relationship",
    "spec_version": "2.1",
    "id": "relationship--<UUIDV5>",
    "created_by_ref": "identity--a1cb37d2-3bd3-5b23-8526-47a22694b7e0",
    "created": "<created> time in Indicator",
    "modified": "<modified> time in Indicator",
    "relationship_type": "detects",
    "source_ref": "indicator--<ID>",
    "target_ref": "malware--<ID>",
    "object_marking_refs": [
        "marking-definition--94868c89-83c2-464b-929b-a1a8aa3c8487",
        "marking-definition--a1cb37d2-3bd3-5b23-8526-47a22694b7e0"
    ]
}
```

UUIDv5 is generated using namespace `a1cb37d2-3bd3-5b23-8526-47a22694b7e0` and `source_ref+target_ref`

All the generated objects are placed into STIX bundles directory (`bundles/abuse_ch/sslblacklist`). A bundle is generated per `<Listingreason>`

```json
{
    "type": "bundle",
    "id": "bundle--<UUIDV5>",
    "objects": [
        "ALL STIX OBJECTS CREATED"
    ]
}
```

The UUID is generated using the namespace `a1cb37d2-3bd3-5b23-8526-47a22694b7e0` and an md5 of all the sorted objects in the bundle.

The bundle file is also names in the format `<name>.json`. Where `name` is all lower case and all `.`, `-` and ` ` charachters are replaced with `_`

### What this looks like on a graph

https://miro.com/app/board/uXjVKwqZNss=/

## Output structure

```txt
.
└── bundles/
    └── abuse_ch/
        └── sslblacklist
            ├── bundles
            │   ├── MALWARE_1.json
            │   └── MALWARE_2.json  
            └── stix2_objects
                ├── file
                ├── identity
                ├── indicator
                ├── malware
                ├── marking-definition
                └── identity                
```

## Tests

The `sample_data` directory contains two sets of demo data:

* `sslipblacklist_aggressive_1.csv`
* `sslipblacklist_aggressive_2.csv`

You can run the script using the `--test` flag to replace the `csv_url` variable with the a test csv file passed as the value to this flag.

e.g. 
1
```shell
python3 processors/abuse_ch/sslipblacklist_aggressive/sslipblacklist_aggressive.py --test sslipblacklist_aggressive_1.csv
```

## Run the script

```shell
python3 processors/abuse_ch/sslblacklist/sslblacklist.py
```