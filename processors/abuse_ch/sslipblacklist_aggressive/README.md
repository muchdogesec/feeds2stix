# abuse.ch SSLBL Botnet C2 IP Blacklist - Aggressive

![](processors/abuse_ch/sslipblacklist_aggressive/sslipblacklist_aggressive.png)

## tl;dr logic of the script

The script works like so

1. downloads csv from `https://sslbl.abuse.ch/blacklist/sslipblacklist_aggressive.csv`
2. turns the entries found in the csv doc into STIX objects (as described in this doc). STIX objects are stored to the filesystemstore in `bundles/abuse_ch/sslipblacklist_aggressive/stix2_objects`.
3. the stix objects are stored in STIX bundles by year `2024.json`, `2023.json`, etc. The year is based on the records lowest `Firstseen` in the csv.

## Overview

> An SSL certificate can be associated with one or more servers (IP address:port combination). SSLBL collects IP addresses that are running with an SSL certificate blacklisted on SSLBL. These are usually botnet Command&Control servers (C&C). SSLBL hence publishes a blacklist containing these IPs which can be used to detect botnet C2 traffic from infected machines towards the internet, leaving your network. The CSV format is useful if you want to process the blacklisted IP addresses further, e.g. loading them into your SIEM. The CSV contains the following values:
> * Firstseen(UTC)
> * Destination IP (DstIP)
> * Destination Port (DstPort)

https://sslbl.abuse.ch/blacklist/#botnet-c2-ips-csv

## Data source

https://sslbl.abuse.ch/blacklist/sslipblacklist_aggressive.csv

## Data schema

```
################################################################
# abuse.ch SSLBL Botnet C2 IP Blacklist (CSV)                  #
# Last updated: 2024-07-10 21:06:20 UTC                        #
#                                                              #
# Terms Of Use: https://sslbl.abuse.ch/blacklist/              #
# For questions please contact sslbl [at] abuse.ch             #
################################################################
#
# Firstseen,DstIP,DstPort
2024-07-10 21:06:20,65.109.241.221,443
2024-07-10 11:18:28,15.235.151.228,8848
2024-07-09 14:27:43,158.247.208.174,443
2024-07-09 10:27:08,95.217.27.167,443
```

## Data Normalisation

n/a

## STIX objects

### Imported objects:

* marking-definition: https://raw.githubusercontent.com/muchdogesec/stix4doge/main/objects/marking-definition/feeds2stix.json
* identity: https://raw.githubusercontent.com/muchdogesec/stix4doge/main/objects/identity/feeds2stix.json

### Generated object mappings

```json
{
	"type": "ipv4-addr",
	"spec_version": "2.1",
	"id": "ipv4-addr--<GENERATED BY STIX2 LIB>",
	"value": "<DstIP>"
}
```


```json
{
	"type": "network-traffic",
	"spec_version": "2.1",
	"id": "network-traffic--<GENERATED BY STIX2 LIB>",
	"dst_ref": "<CORRESPONDING IPV4 ADDR OBJECT>",
	"dst_port": "<DstPort>",
	"protocols": [
		"<SEE DICTIONARY IN NOTES>"
	]
}
```

For `protocols`, if `DstPort` =

* `80` then = [`http`, `tcp`]
* `443` then = [`ssl`, `tcp`]
* any other value then = [`tcp`]

```json
{
    "type": "indicator",
    "spec_version": "2.1",
    "id": "indicator--<UUIDv5>",
    "created_by_ref": "identity--a1cb37d2-3bd3-5b23-8526-47a22694b7e0",
    "created": "Earliest <Firstseen> for <DstIP>",
    "modified": "Latest <Firstseen> for <DstIP>",
    "indicator_types": [
    	"malicious-activity"
    ],
    "name": "C&C Botnet: <DstIP>",
    "pattern": "([ipv4-addr:value = '<DstIP>' AND network-traffic:dst_port = '<DstPort>'] OR [ipv4-addr:value = '<DstIP>' AND network-traffic:dst_port = '<DstPort>'])",
    "pattern_type": "stix",
    "valid_from": "<Firstseen>",
    "object_marking_refs": [
        "marking-definition--94868c89-83c2-464b-929b-a1a8aa3c8487",
        "marking-definition--a1cb37d2-3bd3-5b23-8526-47a22694b7e0"
    ]
  }
```

Note, it is possible that the same ID has multiple entries, with differing `<DstPort>` values. These are all captured in the `pattern` property

UUIDv5 is generated using namespace `a1cb37d2-3bd3-5b23-8526-47a22694b7e0` (feed marking definition uuid) and value `name`

```json
{
	"type": "relationship",
	"spec_version": "2.1",
	"id": "relationship--<same as indicator id>",
    "created": "Same as source_ref indicator",
    "modified": "Same as source_ref indicator",
    "created_by_ref": "identity--a1cb37d2-3bd3-5b23-8526-47a22694b7e0",
    "relationship_type": "detects",
    "source_ref": "indicator--<ID>",
    "target_ref": "ipv4-addr--<ID>",
    "object_marking_refs": [
        "marking-definition--94868c89-83c2-464b-929b-a1a8aa3c8487",
        "marking-definition--a1cb37d2-3bd3-5b23-8526-47a22694b7e0"
    ]
}
```

Note, because the Indicator represents a single ipv4-addr, only one relationship will ever exist between an indicator and ipv4-addr

All the generated objects are placed into STIX bundles directory (`bundles/abuse_ch/sslipblacklist_aggressive`).

A bundle is generated per year (containing all objects with `modified` time in the year, and all linked ipv4-addr and network-traffic object) and named as follows `2024.json`, `2023.json`, etc

```json
{
    "type": "bundle",
    "id": "bundle--<UUIDV5>",
    "objects": [
        "ALL STIX OBJECTS CREATED"
    ]
}
```

The UUID is generated using the namespace `a1cb37d2-3bd3-5b23-8526-47a22694b7e0` and an md5 of all the sorted objects in the bundle.

### What this looks like on a graph

https://miro.com/app/board/uXjVKwqZNss=/

## Output structure

```txt
.
└── bundles/
    └── abuse_ch/
        └── sslipblacklist_aggressive
            ├── bundles
            │   ├── 2024.json
            │   ├── YYYY.json
            │   └── revoked_indicators.json   
            └── stix2_objects
                ├── identity
                ├── indicator
                ├── ipv4-addr
                ├── marking-definition
                ├── network-traffic
                └── relationship
```

## Tests

The `sample_data` directory contains two sets of demo data:

* `sslipblacklist_aggressive_1.csv`
* `sslipblacklist_aggressive_2.csv`

You can run the script using the `--test` flag to replace the `csv_url` variable with the a test csv file passed as the value to this flag.

e.g. 

```shell
python3 processors/abuse_ch/sslipblacklist_aggressive/sslipblacklist_aggressive.py --test sslipblacklist_aggressive_1.csv
```

## Run the script

```shell
python3 processors/abuse_ch/sslipblacklist_aggressive/sslipblacklist_aggressive.py
```